{% load i18n static solo_tags %}
{% get_solo 'web_configurations.GeneralConfiguration' as general_configuracion %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" class="{% block html_class %}{% endblock %}">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description"
          content="Su aliado tecnológico en líneas y procesos de producción. Somos una compania con 25 años de participacion en el mercado nacional e internacional. Involucrandonos en todas las necesidades del proceso productivo de los diferentes sectores industriales.">

    <title>Odecopack - {% block title %}{% endblock %}</title>
    <link media="screen" href="{% static 'web/sass/mdb.min.css' %}" rel="stylesheet">
    <!-- Font Awesome -->
    <noscript>
        <link media="screen" rel="stylesheet" href="{% static 'web/css/font-awesome.min.css' %}">
        <!-- Bootstrap core CSS -->
        <link media="screen" href="{% static 'web/css/bootstrap.min.css' %}" rel="stylesheet">
        <!-- Material Design Bootstrap -->
        <link media="screen" href="{% static 'web/sass/mdb.min.css' %}" rel="stylesheet">
        <!-- Your custom styles (optional) -->
        <link media="screen"
              href="{% static 'web/css/style.min.css' %}?version={{ general_configuracion.version_css_cache }}hola"
              rel="stylesheet">
    </noscript>

    <link rel="icon" href="{% static 'web/img/favicon.ico' %}">

    {% if user.is_anonymous %}
        {% include 'web/base/google_analitics.html' %}
    {% else %}
        {% if user.is_authenticated and user.tercero %}
            {% if user.tercero.es_cliente %}
                {% include 'web/base/google_analitics.html' %}
            {% endif %}
        {% endif %}
    {% endif %}

</head>

<body>
<header>
    {% block menu %}
        {% include 'web/base/menu.html' with es_menu_index=False %}
    {% endblock %}
</header>
<!--Main Navigation-->
<div id="mdb-lightbox-ui">

</div>

{% block cabezote %}

{% endblock %}

<main>
    <div id="fb-root"></div>
    {% block content %}

    {% endblock %}
</main>
{% include 'web/base/contactenos.html' %}
{% block footer %}
    {% include 'web/base/footer.html' %}
{% endblock %}

<script type="text/javascript" src="{% static 'web/js/jquery-3.2.1.min.js' %}"></script>
<script>
    function preventPassiveListener(ev) {
        //ev.preventDefault();
    }

    function defer_script_load(script_file, defer, async, callback) {
        var giftofspeed = document.createElement('script');
        giftofspeed.src = script_file;
        giftofspeed.defer = defer;
        giftofspeed.async = async;
        var godefer = document.getElementsByTagName('script')[0];
        if (callback) {
            godefer.addEventListener('load', function (e) {
                callback(null, e);
            }, false);
        }
        godefer.parentNode.insertBefore(giftofspeed, godefer);
    }

    function defer_css_load(css_file) {
        var giftofspeed = document.createElement('link');
        giftofspeed.rel = 'stylesheet';
        giftofspeed.href = css_file;
        var godefer = document.getElementsByTagName('link')[0];
        godefer.parentNode.insertBefore(giftofspeed, godefer);
    }

    function WebpIsSupported(callback) {
        // If the browser doesn't has the method createImageBitmap, you can't display webp format
        if (!window.createImageBitmap) {
            callback(false);
            return;
        }

        // Base64 representation of a white point image
        var webpdata = 'data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoCAAEAAQAcJaQAA3AA/v3AgAA=';

        // Retrieve the Image in Blob Format
        fetch(webpdata).then(function (response) {
            return response.blob();
        }).then(function (blob) {
            // If the createImageBitmap method succeeds, return true, otherwise false
            createImageBitmap(blob).then(function () {
                callback(true);
            }, function () {
                callback(false);
            });
        });
    }

    function suportPassiveListeners() {
        var supportsPassive = false;
        try {
            var opts = Object.defineProperty({}, 'passive', {
                get: function () {
                    supportsPassive = true;
                }
            });
            window.addEventListener("testPassive", null, opts);
            window.removeEventListener("testPassive", null, opts);
        } catch (e) {
        }
        return supportsPassive
    }

    function inicial() {

        $(function () {
            $("#mdb-lightbox-ui").load("{% static 'web/mdb-addons/mdb-lightbox-ui.html' %}");
        });
        $('.navbar-nav>li>a').on('click', function () {
            $('.navbar-collapse').collapse('hide');
        });

        $('.modal').on('hide.bs.modal', function (e) {
            var $if = $(e.delegateTarget).find('iframe');
            var src = '';
            for (i = 0; i < $if.length; i++) {
                src = $if[i].src;
                $if[i].src = '/empty.html';
                $if[i].src = src;
            }
        });

        $('.modal').on('show.bs.modal', function (e) {

            {% if user.is_anonymous %}
                ga('send', {
                    hitType: 'event',
                    eventCategory: e.target.title,
                    eventAction: 'click',
                    eventLabel: e.target.id
                });
            {% else %}
                {% if user.is_authenticated and user.tercero %}
                    {% if user.tercero.es_cliente %}
                        ga('send', {
                            hitType: 'event',
                            eventCategory: e.target.title,
                            eventAction: 'click',
                            eventLabel: e.target.id
                        });
                    {% endif %}
                {% endif %}
            {% endif %}
        });


        var suportPassive = suportPassiveListeners();
        document.addEventListener('touchstart', preventPassiveListener, suportPassive ? {passive: true} : false);
        document.addEventListener('wheel', preventPassiveListener, suportPassive ? {passive: true} : false);
        document.addEventListener('mousewheel', preventPassiveListener, suportPassive ? {passive: true} : false);
        document.addEventListener('touchmove', preventPassiveListener, suportPassive ? {passive: true} : false);

        if ('IntersectionObserver' in window) {
            var preloadImage = function (elemento) {
                elemento.setAttribute('src', elemento.getAttribute('data-src'));
            };
            var preloadSource = function (elemento) {
                elemento.setAttribute('srcset', elemento.getAttribute('data-srcset'));
            };

            var myObserver = new IntersectionObserver(function (entries, self) {
                entries.forEach(function (entry) {
                    if (entry.isIntersecting) {
                        if (entry.target.getAttribute('data-src')) {
                            preloadImage(entry.target);
                        }
                        if (entry.target.getAttribute('data-srcset')) {
                            preloadSource(entry.target);
                        }
                        self.unobserve(entry.target);
                    }
                })
            }, {
                root: null,
                rootMargin: "300px"
            });

            var elementToObserve = document.getElementsByTagName('img');
            for (var i = 0; i < elementToObserve.length; i++) {
                if (elementToObserve[i].getAttribute('data-src')) {
                    myObserver.observe(elementToObserve[i]);
                }
            }

            var elementVideoToObserve = document.getElementsByTagName('iframe');
            for (var i = 0; i < elementVideoToObserve.length; i++) {
                if (elementVideoToObserve[i].getAttribute('data-src')) {
                    myObserver.observe(elementVideoToObserve[i]);
                }
            }

            var elementSourceToObserve = document.getElementsByTagName('source');
            for (var i = 0; i < elementSourceToObserve.length; i++) {
                if (elementSourceToObserve[i].getAttribute('data-srcset')) {
                    myObserver.observe(elementSourceToObserve[i]);
                }
            }
        } else {
            var vidDefer = document.getElementsByTagName('iframe');
            for (var i = 0; i < vidDefer.length; i++) {
                if (vidDefer[i].getAttribute('data-src')) {
                    vidDefer[i].setAttribute('src', vidDefer[i].getAttribute('data-src'));
                }
            }
            var imgDefer = document.getElementsByTagName('img');
            for (var i = 0; i < imgDefer.length; i++) {
                if (imgDefer[i].getAttribute('data-src')) {
                    imgDefer[i].setAttribute('src', imgDefer[i].getAttribute('data-src'));
                }
            }
            var sourceDefer = document.getElementsByTagName('script');
            for (var i = 0; i < imgDefer.length; i++) {
                if (sourceDefer[i].getAttribute('data-srcset')) {
                    sourceDefer[i].setAttribute('src', sourceDefer[i].getAttribute('data-srcset'));
                }
            }
        }

        defer_script_load("{% static 'web/js/mdb.min.js' %}", false, false, function () {
            new WOW().init();
        });
        defer_script_load("{% static 'web/js/popper.min.js' %}", true, false, null);
        defer_script_load("{% static 'web/js/bootstrap.min.js' %}", true, false, null);
        defer_css_load("{% static 'web/css/font-awesome.min.css' %}");
        defer_css_load("{% static 'web/css/bootstrap.min.css' %}");
        defer_css_load("{% static 'web/css/style.min.css' %}?version={{ general_configuracion.version_css_cache }}hola");
        defer_script_load("https://maps.googleapis.com/maps/api/js?key=AIzaSyDnHDS9_MmBdyoGZgKYTkqb2C5ii6lvFaU&callback=initMap", true, false);
        defer_script_load("https://www.google.com/recaptcha/api.js", true, false, null);

        {% block onLoadScript %}

        {% endblock %}
    }

    window.onload = inicial;
    {% block final_scripts %}
    {% endblock %}
</script>

</body>

</html>